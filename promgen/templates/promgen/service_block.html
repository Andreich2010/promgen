{% load i18n %}
<div class="panel panel-default">
  <div class="panel-heading">
    <a href="{% url 'service-detail' service.id %}">{{ service.name }}</a>
    <span class="pull-right form-inline">
      {% include "promgen/mute_form.inc.html" with label=service.name %}
    </span>
    <div class="clearfix"></div>
  </div>

<div class="panel-heading">Notifications</div>
{% if service.sender.count %}
<table class="table table-bordered table-condensed">
  <tr>
    <th>Sender</th>
    <th>Value</th>
  </tr>
  {% for sender in service.sender.all %}
  <tr>
    <td>{{ sender.sender }}</td>
    <td>{{ sender.show_value }}</td>
    <td>
      <form method="post" action="{% url 'sender-test' sender.id %}" style="display: inline">
        {% csrf_token %}
        <button class="btn btn-danger">{% trans "Test" %}</button>
      </form>
    </td>
    <td>
      <form method="post" action="{% url 'sender-delete' sender.id %}" onsubmit="return confirm('{% trans "Delete notificiation?" %}')" style="display: inline">
        {% csrf_token %}
        <button class="btn btn-danger">{% trans "Delete" %}</button>
      </form>
    </td>
  </tr>
  {% endfor %}
</table>
{% endif %}

<div class="panel-heading">Projects</div>
{% if service.project_set.count %}
<table class="table table-bordered table-condensed">
  <tr>
    <th>Project</th>
    <th>Farm</th>
    <th>Exporters</th>
    <th>Senders</th>
    <th>&nbsp;</th>
  </tr>
{% for project in service.project_set.all %}
  <tr>
    <td><a href="{% url 'project-detail' project.id %}">{{ project.name }}</a></td>
    <td>{% if project.farm %}{{ project.farm }}{% endif %}</td>
    <td>
      <table style="width: 100%">
{% for exporter in project.exporter_set.all %}
        <tr>
          <td>{{ exporter.job }}</td>
          <td>{{ exporter.port }}</td>
          <td>{{ exporter.path }}</td>
        </tr>
{% endfor %}
      </table>
    </td>
    <td>
      <table style="width: 100%">
{% for sender in project.sender.all %}
        <tr>
          <td>{{ sender.sender }}</td>
          <td>{{ sender.show_value }}</td>
        </tr>
{% endfor %}
      </table>
    </td>
    <td>
      {% include "promgen/mute_form.inc.html" with label=service.name|add:"-"|add:project.name %}
    </td>
  </tr>
{% endfor %}
</table>
{% endif %}

  <div class="panel-footer">
    <a href="{% url 'project-new' service.id %}" class="btn btn-primary">{% trans "Register Project" %}</a>
    <a href="{% url 'service-sender' service.id %}" class="btn btn-primary">{% trans "Register Sender" %}</a>
    <a href="{% url 'service-update' service.id %}" class="btn btn-warning">{% trans "Edit Service" %}</a>
    <a href="{% url 'service-rules' service.id %}" class="btn btn-default">{% trans "Rules" %}</a>
    <a href="{% url 'service-export' service.id %}" class="btn btn-default">{% trans "Export Service" %}</a>
    <form method="post" action="{% url 'service-delete' service.id %}" onsubmit="return confirm('{% trans "Delete this service?" %}')" style="display: inline">
      {% csrf_token %}
      <button class="btn btn-danger">{% trans "Delete Service" %}</button>
    </form>
  </div>
</div>
