{% extends "base.html" %}

{% block content %}

{% if service %}
<div class="page-header">
  <h1>Service: {{ service.name }}</h1>
</div>

<ol class="breadcrumb">
  <li><a href="{% url 'service-list' %}">Home</a></li>
  <li><a href="{% url 'service-detail' service.id %}">{{ service.name }}</a></li>
  <li class="active">List Rules</li>
</ol>
{% else %}
<div class="page-header">
  <h1>Rules</h1>
</div>

<ol class="breadcrumb">
  <li><a href="{% url 'service-list' %}">Home</a></li>
  <li class="active">List Rules</li>
</ol>
{% endif %}

<div class="panel panel-default">
    <table class="table table-bordered table-condensed">
      <thead>
        <tr>
          <th>Name</th>
          <th>Clause</th>
          <th>Duration</th>
          <th>Labels</th>
          <th>Annotations</th>
          {% if service %}
          <th>&nbsp;</th>
          {% else %}
          <th>Service</th>
          {% endif %}
        </tr>
      </thead>
{% for rule in rule_list %}
      <tr {% if rule.enabled == False %}class="rule-off"{% endif %}>
        <td>{{ rule.name }}</td>
        <td style="word-break: break-word;">{{ rule.clause }}</td>
        <td>{{ rule.duration }}</td>
        <td>{{ rule.labels }}</td>
        <td style="word-break: break-word;">{{ rule.annotations }}</td>
        <td>
          <a href="{% url 'rule-edit' rule.id %}" class="btn btn-primary">Edit</a>
          <form method="post" action="{% url 'rule-toggle' rule.id %}" style="display: inline">
            {% csrf_token %}
            {% if rule.enabled %}
            <button class="btn btn-default">Disable</button>
            {% else %}
            <button class="btn btn-primary">Enable</button>
            {% endif %}
          </form>
          <form method="post" action="{% url 'rule-delete' rule.id %}" onsubmit="return confirm('Delete this rule?')" style="display: inline">
            {% csrf_token %}
            <button class="btn btn-danger">Delete</button>
          </form>
        </td>
        <td><a href="{% url 'service-detail' rule.service.id %}">{{ rule.service }}</a></td>
      </tr>
{% endfor %}
    </table>

    {% if service %}
    <div class="panel-footer">
      <a href="{% url 'rule-new' service.id %}" class="btn btn-primary">
        Register new Rule</a>

        <form action="{% url 'rule-copy' service.id %}" method="post" style="display: inline">
            {% csrf_token %}
            {{ view.form.rule_id }}
            <button class="btn btn-primary">Duplicate Rule</button>
        </form>
    </div>
    {% endif %}

</div>

{% endblock %}
